{% extends 'base_modern.html' %}
{% load static %}

{% block title %}Verify OTP - Nexteons HR{% endblock %}
{% block header_title %}Verify & Reset{% endblock %}
{% block page_subtitle %}Securely reset your password.{% endblock %}

{% block content %}
<div class="auth-container" style="max-width: 480px; margin: 0 auto; width: 100%;">
    <div class="card shadow-lg">
        <div class="card-header border-bottom">
            <div class="header-content">
                <h3 class="card-title">Verify OTP</h3>
                <p class="card-subtitle">
                    Enter the code sent to <strong class="text-primary">{{ email }}</strong>
                </p>
            </div>
            <div class="icon-box-lg">
                <i class="ri-shield-key-line"></i>
            </div>
        </div>

        <form method="post" class="p-6">
            {% csrf_token %}
            
            {% if form.non_field_errors %}
            <div class="alert alert-error mb-6">
                {% for error in form.non_field_errors %}
                    <div class="alert-content">
                        <i class="ri-error-warning-line"></i>
                        {{ error }}
                    </div>
                {% endfor %}
            </div>
            {% endif %}

            <div class="form-stack">
                <div class="form-group">
                    <label class="form-label text-center" for="{{ form.otp.id_for_label }}">Enter 6-Digit OTP</label>
                    <div class="otp-wrapper">
                        {{ form.otp }}
                    </div>
                    {% if form.otp.errors %}
                    <div class="field-error text-center">
                        {{ form.otp.errors.0 }}
                    </div>
                    {% endif %}
                </div>

                <div class="form-group margin-top-md">
                    <label class="form-label" for="{{ form.new_password.id_for_label }}">New Password</label>
                    <div class="input-wrapper-icon">
                        <i class="ri-lock-line input-icon"></i>
                        {{ form.new_password }}
                    </div>
                    {% if form.new_password.errors %}
                    <div class="field-error">
                        {{ form.new_password.errors.0 }}
                    </div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label class="form-label" for="{{ form.confirm_password.id_for_label }}">Confirm Password</label>
                    <div class="input-wrapper-icon">
                        <i class="ri-lock-check-line input-icon"></i>
                        {{ form.confirm_password }}
                    </div>
                    {% if form.confirm_password.errors %}
                    <div class="field-error">
                        {{ form.confirm_password.errors.0 }}
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="form-actions mt-8">
                <button type="submit" class="btn btn-primary btn-lg w-full">
                    Reset Password <i class="ri-check-line ml-2"></i>
                </button>
            </div>
        </form>
    </div>

    <div class="text-center mt-6">
        <a href="{% url 'password_reset_request' %}" class="btn-link">
            <i class="ri-refresh-line"></i> Resend OTP
        </a>
    </div>
</div>

<style>
    /* Styling adjustments for the auth pages */
    .icon-box-lg {
        width: 48px;
        height: 48px;
        background: rgba(37, 99, 235, 0.1);
        color: var(--primary);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
    }

    .border-bottom {
        border-bottom: 1px solid var(--gray-200);
        padding-bottom: 20px;
    }

    .p-6 { padding: 24px; }
    .mb-6 { margin-bottom: 24px; }
    .mt-6 { margin-top: 24px; }
    .mt-8 { margin-top: 32px; }
    .ml-2 { margin-left: 8px; }
    
    .text-primary { color: var(--primary); }
    .text-center { text-align: center; }

    .input-wrapper-icon {
        position: relative;
    }

    .input-icon {
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray-400);
        font-size: 18px;
        z-index: 10;
    }

    /* Target the input rendered by Django form */
    .form-input {
        padding-left: 44px !important;
        height: 48px;
        border-radius: 12px;
    }
    
    /* Specific override for OTP input which shouldn't have left padding for icon if we don't put one, 
       or we center it. The form definition has style="text-align: center".
       Let's override the padding-left only for the OTP input if possible, 
       or since I didn't verify if I can target it specifically by class without affecting others...
       Actually, the form widget has 'form-input' class. 
       The template above adds .input-wrapper-icon only for passwords.
       So the OTP input will presumably just have .form-input. 
       Wait, .form-input has standard padding. 
       I should perhaps make a specific rule for the OTP input or ensure it doesn't get the padding-left: 44px if it's not in a wrapper with icon.
       But .form-input is global class? 
       In the style block above, I targeted .form-input.
    */
    .form-input {
        padding-left: 16px; /* Default */
    }
    
    .input-wrapper-icon .form-input {
        padding-left: 44px !important;
    }
    
    /* OTP Input Specifics */
    .otp-wrapper input {
        font-size: 24px !important;
        letter-spacing: 8px !important;
        height: 60px !important;
        padding-left: 0 !important; /* It is centered */
    }

    .btn-lg {
        height: 48px;
        font-size: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .w-full { width: 100%; }

    .btn-link {
        color: var(--gray-600);
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: color 0.2s;
    }

    .btn-link:hover { color: var(--primary); }

    .alert-error {
        background: #FEF2F2;
        color: #DC2626;
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
    }
    
    .alert-content {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .field-error {
        color: #DC2626;
        font-size: 12px;
        margin-top: 6px;
        font-weight: 500;
    }
    
    .form-stack {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
</style>
{% endblock %}