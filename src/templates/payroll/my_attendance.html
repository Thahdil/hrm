{% extends 'base_modern.html' %}

{% block title %}My Attendance - EONS HRM{% endblock %}
{% block header_title %}My Attendance Records{% endblock %}

{% block content %}
<div class="flex-1" style="width: 100%; display: flex; flex-direction: column;">
    
    <!-- Header with Filters -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px;">
        <div>
            <h3 class="section-title">Attendance History</h3>
            <p style="color: var(--text-secondary); font-size: 0.9rem;">View your daily check-in and check-out records.</p>
        </div>

        <form method="get" style="display: flex; align-items: center; gap: 10px; background: #fff; padding: 8px; border: 1px solid #e2e8f0; border-radius: 8px;">
            <div style="display: flex; flex-direction: column;">
                <label style="font-size: 0.75rem; color: #64748b; margin-bottom: 2px;">Start Date</label>
                <input type="date" name="start_date" value="{{ start_date|default:'' }}" 
                    style="border: 1px solid #cbd5e1; padding: 6px; border-radius: 6px; font-size: 0.9rem; color: #334155;">
            </div>
            <div style="display: flex; flex-direction: column;">
                <label style="font-size: 0.75rem; color: #64748b; margin-bottom: 2px;">End Date</label>
                <input type="date" name="end_date" value="{{ end_date|default:'' }}" 
                    style="border: 1px solid #cbd5e1; padding: 6px; border-radius: 6px; font-size: 0.9rem; color: #334155;">
            </div>
            <button type="submit" class="btn btn-primary" style="height: 38px; margin-top: 14px; padding: 0 20px;">
                <i class="ri-filter-3-line"></i> Filter
            </button>
            {% if start_date or end_date %}
            <a href="{% url 'my_attendance' %}" style="margin-top: 14px; color: #ef4444; text-decoration: none; padding: 0 8px;">
                <i class="ri-close-circle-line" style="font-size: 1.2rem;"></i>
            </a>
            {% endif %}
        </form>
    </div>

    <!-- Attendance Table -->
    <div style="background: white; border-radius: 12px; border: 1px solid var(--border); overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background-color: #f8fafc; border-bottom: 1px solid #e2e8f0;">
                    <th style="padding: 16px; text-align: left; font-weight: 600; color: #475569; font-size: 0.9rem;">Date</th>
                    <th style="padding: 16px; text-align: left; font-weight: 600; color: #475569; font-size: 0.9rem;">Punch Breakdown</th>
                    <th style="padding: 16px; text-align: left; font-weight: 600; color: #475569; font-size: 0.9rem;">Hours</th>
                    <th style="padding: 16px; text-align: left; font-weight: 600; color: #475569; font-size: 0.9rem;">Status</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr style="border-bottom: 1px solid #f1f5f9; hover: {background-color: #f8fafc};">
                    <td style="padding: 16px; font-weight: 500; color: #1e293b;">
                        <div style="font-weight: 700;">{{ log.date|date:"M d, Y" }}</div>
                        <div style="font-size: 0.8rem; color: #64748b;">{{ log.date|date:"l" }}</div>
                    </td>
                    <td style="padding: 16px; color: #334155;">
                        {% if log.shortfall_minutes > 0 %}
                            <div style="display: inline-flex; align-items: center; gap: 6px; background: #fff1f2; color: #be123c; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 800; border: 1px solid #ffe4e6;">
                                <i class="ri-time-line"></i> {{ log.shortfall_str }}
                            </div>
                        {% else %}
                            {% if log.status == 'Present' or log.status == 'HalfDay' %}
                                <span style="color: #059669; font-size: 0.85rem; font-weight: 700;">Full Shift Done</span>
                            {% else %}
                                <span style="color: #cbd5e1;">--</span>
                            {% endif %}
                        {% endif %}
                    </td>
                    <td style="padding: 16px; font-weight: 600;">
                        {{ log.hours_str }}
                    </td>
                    <td style="padding: 16px;">
                        {% if log.is_absent %}
                            <div style="display: inline-flex; align-items: center; gap: 6px; background: #fff1f2; color: #be123c; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 800; border: 1px solid #ffe4e6;">
                                <i class="ri-close-circle-fill" style="font-size: 13px;"></i> ABSENT
                            </div>
                        {% elif log.is_compliant %}
                            <div style="display: inline-flex; align-items: center; gap: 6px; background: #ecfdf5; color: #059669; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 800; border: 1px solid #d1fae5;">
                                <i class="ri-checkbox-circle-fill" style="font-size: 13px;"></i> PRESENT
                            </div>
                        {% else %}
                             <div style="display: inline-flex; align-items: center; gap: 6px; background: #fffcf0; color: #ca8a04; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 800; border: 1px solid #fef3c7;">
                                <i class="ri-error-warning-fill" style="font-size: 13px;"></i> SHORT
                            </div>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="padding: 40px; text-align: center; color: #94a3b8;">
                        <i class="ri-file-list-3-line" style="font-size: 2.5rem; display: block; margin-bottom: 10px; opacity: 0.5;"></i>
                        No attendance records found for the selected period.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
